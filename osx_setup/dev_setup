#!/bin/zsh

## end setup on fail
set -e

echo "Installing Xcode Command Line Tools"
xcode-select --install 
echo "Xcode Command Line Tools installed"
echo "Installing Oh My ZSH"
OVERWRITE_CONFIRMATION="no"
sh -c "$(curl -fsSL https://raw.githubusercontent.com/ohmyzsh/ohmyzsh/master/tools/install.sh)" "" --unattended
echo "Oh My ZSH installed"
clear

echo "Installing Homebrew"
/bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"

if [[ "$(uname -m)" == "arm64" ]]; then
    echo "Arm64 detected, adding homebrew to path"
    echo 'eval "$(/opt/homebrew/bin/brew shellenv)"' >> ~/.zshrc
    eval "$(/opt/homebrew/bin/brew shellenv)"
    source ~/.zshrc
fi
echo "Homebrew installed and PATH configured"
echo "Installing awscli, python"
brew install --force awscli python 
# i don't know why TC put this upgrade line in, but i'll keep it here just in case
brew upgrade --force awscli python 
echo "Installing mysqlworkbench, firefox, google-chrome, slack, studio-3t-community, postman, cyberduck, vscode, docker, zoom"
brew install --cask --force mysqlworkbench firefox google-chrome slack studio-3t-community postman cyberduck visual-studio-code docker-desktop zoom
clear

brew doctor

clear
# WE ARE USING NVM INSTEAD OF INSTALLING NODE THROUGH HOMEBREW BECAUSE
# 1. NODE GETS A NEW LTS VERSION EVERY YEAR
# 2. YOU DON'T HAVE TO COMPILE NODE FROM SOURCE WHEN YOUR MACOS VERSION IS UNSUPPORTED BY HOMEBREW
echo "Installing nvm"
bash -c 'curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.40.3/install.sh | bash'
echo "nvm installed"
echo "Installing latest node.js LTS version and yarn"
echo "yarn" >> ~/.nvm/default-packages
nvm install --lts
echo "Node.js LTS and yarn are installed"

echo "config npm to silence npm update notifier"
echo "update-notifier=false" >> ~/.npmrc
echo "npm configured"
echo "Install complete, restart your shell and/or system!"
